<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ecom.javacodings.merchandiser.access.OrderManagerDAO">
	
	<insert id="orderUpdate" parameterType="OrderDTO">
		<foreach collection="orders" item="order" separator="" open="INSERT ALL " close="SELECT 1 FROM DUAL">
			INSERT INTO ORDERS (ORDER_ID, ITEM_ID, MEMBER_ID, QUANTITY, STATE, REG_DATE) 
			SELECT #{order_id}, #{item_id}, #{member_id}, #{quantity}, #{state}+1, sysdate 
			FROM ORDERS 
			ORDER BY REG_DATE DESC 
			WHERE ORDER_ID = #{order_id}
		</foreach>
	</insert>
   
<!-- 	<insert id="orderUpdate" parameterType="OrderDTO">
		<foreach collection="orders" item="order" separator="" open="INSERT ALL " close="SELECT 1 FROM DUAL">
			INTO ORDERS (ORDER_ID, ITEM_ID, MEMBER_ID, QUANTITY, STATE, REG_DATE) 
			VALUES (#{order_id}, #{item_id}, #{member_id}, #{quantity}, #{state}+1, sysdate) 
		</foreach>
	</insert> -->

   
   <select id="orderList" parameterType="pageDTO" resultType="OrderDTO">
	 SELECT * 
	 FROM (SELECT ORDER_ID, ITEM_ID, MEMBER_ID, QUANTITY, STATE, REG_DATE, ROW_NUMBER() over (ORDER BY REG_DATE DESC) AS RN 
      FROM ORDERS)
        WHERE RN BETWEEN #{start} AND #{end}
	</select>
	<select id="orderStateCnt" resultType="int">
      SELECT COUNT(state)
        FROM ORDERS
        ORDER BY REG_DATE DESC 
        GROUP BY order_id
        WHERE state = #{value}
    </select>
</mapper>