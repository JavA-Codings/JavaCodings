<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ecom.javacodings.customer.access.members.MemberDAO">
	<!-- Region Metadata -->

	<select id="isExistMemberID" resultType="int">
		SELECT CASE WHEN COUNT(MEMBER_ID) > 0 THEN '1' ELSE '0' END
		FROM MEMBERS
		WHERE MEMBER_ID = #{member_id}
	</select>

	<!-- End Region Metadata -->
	<!-- Region Basic CRUD -->

	<select id="findByIdAndPassword" resultType="memberDTO">
		SELECT
			M.MEMBER_ID, M.PASSWORD, M.ROLE, M."LEVEL",
			I.NAME, I.EMAIL, I.BIRTH, I.PHONE
		FROM MEMBERS M, MEMBER_INFOS I
		WHERE M.MEMBER_ID = #{member_id} AND M.PASSWORD=#{password}
		  AND M.MEMBER_ID = I.MEMBER_ID
	</select>

	<select id="getMemberIdByNameAndPhone" resultType="string">
		SELECT MEMBER_ID
		FROM MEMBER_INFOS
		WHERE NAME = #{name} AND EMAIL = #{email}
	</select>

	<insert id="add" useGeneratedKeys="false">
		INSERT INTO MEMBERS(MEMBER_ID, PASSWORD)
		VALUES (#{member_id}, #{password})
	</insert>

	<update id="setPasswordByMemberId">
		UPDATE MEMBERS 
		SET PASSWORD = #{password}
		WHERE MEMBER_ID = #{member_id}
	</update>
	
	<delete id="archiveByMemberID" parameterType="String">
		UPDATE MEMBERS
		SET ROLE = 'ARCHIVED'
		WHERE MEMBER_ID = #{value}
	</delete>

	<!-- End Region Basic CRUD -->

	<update id="editByPriorityAndMemberId">
		UPDATE MEMBER_ADDRESSES SET
									ZIPCODE  = #{zipcode},
									ADDRESS  = #{address},
									ADDRESS2 = #{address2}
		WHERE MEMBER_ID = #{member_id}
	</update>

	<update id="setPriorityByMemberIdAndPriority">
		UPDATE MEMBER_ADDRESSES
		SET PRIORITY = #{priority}
		WHERE MEMBER_ID = #{member_id} AND PRIORITY = #{criteria}
	</update>

	<delete id="deleteByPriorityAndMemberID">
		DELETE FROM MEMBER_ADDRESSES
		WHERE MEMBER_ID = #{member_id} AND PRIORITY = #{priority}
	</delete>

</mapper>